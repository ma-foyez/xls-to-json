<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Read XL File</title>
    <script src="https://unpkg.com/read-excel-file@4.1.0/bundle/read-excel-file.min.js"></script>
  </head>

  <body>
    <div
      style="
        margin: auto;
        width: 50%;
        margin-top: 80px;
        padding: 30px;
        background: #dedede;
      "
    >
      <h2>Excel To JSON Converter</h2>
      <input type="file" id="input" accept=".xls, .xlsx" />
      <br /><br />
      <textarea
        name="json-data"
        id="json-data"
        rows="25"
        style="width: 100%"
      ></textarea>
      <br /><br />
      <button id="dl-json">Download JSON File</button>
    </div>

    <script>
      var input = document.getElementById("input");
      //data format
      var jsonFormattedData = {
        EmployeeID: "",
        OfficeID: "",
        NameOfEmployee: "",
        bulkDutyDetail: [],
        // bulkDutyDetail: [{
        //     DayNumber: 0,
        //     ShiftName: ""
        // }]
      };

      input.addEventListener("change", function () {
        readXlsxFile(input.files[0]).then(function (data) {
          var i = 0;
          var headers = [];
          var json_object = [];
          console.log("data :>> ", data);
          data.map((row, index) => {
            if (i === 0) {
              headers = row;
            }
            if (i > 0) {
              var temp = {};
              var bulkDutyDetail = [];
              const rowObjectValue = row.slice(0, 3);
              const rowArrayValue = row.slice(3, 60);
              console.log("headers :>> ", headers);
              console.log("row :>> ", row);

              for (let x = 0; x < row.length; x++) {
                temp[headers[x]] = row[x];
                // insert data into formatted json data set
                jsonFormattedData.EmployeeID = temp.EmployeeID;
                jsonFormattedData.NameOfEmployee = temp.NameOfEmployee;
                jsonFormattedData.OfficeID = temp.OfficeID;

                // bulkDutyDetail.DayNumber = x;
                // bulkDutyDetail.ShiftName = "fayez"
                // temp.DayNumber = headers[x]
                // bulkDutyDetail.propertyName = "ShiftName"

                // bulkDutyDetail.ShiftName = row[x
              }

              // find data from header row
              // for (let x = 0; x < headers.length; x++) {
              //     const xyz = headers[x];
              //     console.log('xyz value is :>> ', xyz);
              // }
              console.log("jsonFormattedData :>> ", jsonFormattedData);
              json_object.push(temp);
            }
            i++;
          });
          document.getElementById("json-data").value = JSON.stringify(
            json_object,
            null,
            4
          );
        });
      });
    </script>
  </body>
</html>
